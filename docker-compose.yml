version: '3.8'
services:
  # Product Service
  product-service:
    build: ./product-service
    ports:
      - "8080:8080"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://product-db:5432/product_db
      SPRING_DATASOURCE_USERNAME: product_user
      SPRING_DATASOURCE_PASSWORD: product_pass
      SPRING_REDIS_HOST: product-redis
      SPRING_REDIS_PORT: 6379
    depends_on:
      - product-db
      - product-redis

  product-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: product_db
      POSTGRES_USER: product_user
      POSTGRES_PASSWORD: product_pass
    ports:
      - "5433:5432"

  product-redis:
    image: redis:7-alpine
    ports:
      - "6380:6379"

  # Customer Service
  customer-service:
    build: ./customer-service
    ports:
      - "8081:8081"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://customer-db:5432/customer_db
      SPRING_DATASOURCE_USERNAME: customer_user
      SPRING_DATASOURCE_PASSWORD: customer_pass
      SPRING_REDIS_HOST: customer-redis
      SPRING_REDIS_PORT: 6379
    depends_on:
      - customer-db
      - customer-redis

  customer-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: customer_db
      POSTGRES_USER: customer_user
      POSTGRES_PASSWORD: customer_pass
    ports:
      - "5434:5432"

  customer-redis:
    image: redis:7-alpine
    ports:
      - "6381:6379"

  # Order Service
  order-service:
    build: ./order-service
    ports:
      - "8082:8082"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://order-db:5432/order_db
      SPRING_DATASOURCE_USERNAME: order_user
      SPRING_DATASOURCE_PASSWORD: order_pass
      SPRING_REDIS_HOST: order-redis
      SPRING_REDIS_PORT: 6379
    depends_on:
      - order-db
      - order-redis

  order-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: order_db
      POSTGRES_USER: order_user
      POSTGRES_PASSWORD: order_pass
    ports:
      - "5435:5432"

  order-redis:
    image: redis:7-alpine
    ports:
      - "6382:6379"
